<div id="chatSection">
    <div class="header" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 20px;">
        <span>Chatter Box</span>
        <button onclick="logout()" style="padding: 5px 12px; font-size: 0.8rem; background: #ff4b2b;">Log Out</button>
    </div>
    <div class="message-box" id="chatWindow"></div>
    <div class="input-area">
        <input type="text" id="msgInput" placeholder="Message..." style="margin-bottom: 0;">
        <button onclick="sendMsg()" style="padding: 10px 20px;">Send</button>
    </div>
</div>

<script type="module">
    // Add "signOut" to your imports at the top
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAF0IDQU21LWJ2Rggb7J0rY4F6UlvZaVZg",
        authDomain: "chatterbox-4b7dd.firebaseapp.com",
        databaseURL: "https://chatterbox-4b7dd-default-rtdb.firebaseio.com", 
        projectId: "chatterbox-4b7dd",
        storageBucket: "chatterbox-4b7dd.firebasestorage.app",
        messagingSenderId: "509263602746",
        appId: "1:509263602746:web:01051fc91ecb3bfa384103"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    
    let isSignUpMode = false;

    // --- NEW LOGOUT FUNCTION ---
    window.logout = function() {
        signOut(auth).then(() => {
            // This will trigger onAuthStateChanged below and show the login screen
            location.reload(); // Refresh to clear the message window
        }).catch((error) => {
            alert(error.message);
        });
    };

    window.toggleMode = function() {
        isSignUpMode = !isSignUpMode;
        document.getElementById('title').innerText = isSignUpMode ? "Register" : "Chatter Box";
        document.getElementById('mainBtn').innerText = isSignUpMode ? "Create Account" : "Sign In";
        document.getElementById('toggleAuth').innerText = isSignUpMode ? "Already have an account? Sign In" : "New here? Create an account";
    };

    window.handleAuth = async function() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        try {
            if (isSignUpMode) {
                await createUserWithEmailAndPassword(auth, email, pass);
            } else {
                await signInWithEmailAndPassword(auth, email, pass);
            }
        } catch (error) {
            alert(error.message);
        }
    };

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('chatSection').style.display = 'flex';
            initChat(user);
        } else {
            // If logged out, show the auth screen and hide chat
            document.getElementById('authSection').style.display = 'flex';
            document.getElementById('chatSection').style.display
